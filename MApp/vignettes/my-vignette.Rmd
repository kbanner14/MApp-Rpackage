---
title: "MApp: Model Averaged posteriors plot"
author: "Katharine Banner"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MApp: Model Averaged posteriors plot}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

```{r setup, echo = FALSE}
source("../R/individ_post_fun.R")
source("../R/plotting_fun.R")
source("../R/plotting_fun_bms.R")
```

The `MApp()` function works with lists of posterior draws and the `MApp.bms()` function works with `bma` objects. A quick introduction to Bayesian model averaging and details about the `bms()` function can be found in the `BMS` package vignette (`vignette("BMS")`). 

In brief, model averaging was developed as a predictive tool and its use has been recently extended to model averaging of partial regression coefficients across multiple models. The inference drawn from the latter application of model averaging typically results in explanations of "average effects" for each of the coefficients of interest. The main issue is that interpreting model averaged partial regression coefficients as "average effects" can be very misleading since their interpretations are dependent on what else is in each individual model. Therefore, averaging over posteriors that have very different meanings to form an "avearage effect" often makes little sense. `MApp` provides the user with a visual of how the model averaged posterior distributions are constructed. A detailed discussion of the rational behind the `MApp` plot can be found in _Model Averaging Partial Regression Coefficients: Considerations and Practical Guidelines_, (Banner & Higgs, 2015). Here, we illustrate the utility of the plotting function as well as other useful functions within our pacakge with two examples.

## Example 1: using `MApp.bms()`

We will use the `case0902` data from the `Sleuth2` package for this example. The data are comprised of average values for gestation length (days), litter size (number of offspring), body size (kg) and brain weight (g) for 96 species of mammals. We use the natural log transformation on average brain weight (_lbrain_), body size (_lbody_), and gestation length (_lgest_), as these relationships are approximately linear on the log-log scale. 

```{r, brain, results='asis'}
brainData <- Sleuth2::case0902

# get the data in the proper format for use in BMS
brainData <- brainData[, -c(1)]

# make the appropriate variable transformations
brainData$lbrain <- log(brainData$Brain)
brainData$lbody <- log(brainData$Body)
brainData$lgest <- log(brainData$Gestation)
brainData$litter <- brainData$Litter

# keep only the variables you need in the dataframe
brainData <- brainData[, c(5:8)]

knitr::kable(head(brainData, 10))
```

We can use the `bms` function from the `BMS` package to obtain a `bma` object: 

```{r bmsobj}
brain <- BMS::bms(brainData, g = "UIP", 
                    mprior = "uniform", 
                    user.int = F)
class(brain)
```

`bms` places Zellner's $g$-prior on the coefficients and we specify a discrete uniform prior on the  $2^3=$ `r 2^3` models in the model set (defined by all first order combinations of the potential covariates). Using `MApp.bms()` with an object genreated by `bms()` is simple: 

```{r bmsfig, fig.show = 'hold', fig.width = 7, fig.height = 5, eval = FALSE}
MApp.bms(x = brain, plot.wind = c(1,3))
```

We can add



Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` setion of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
